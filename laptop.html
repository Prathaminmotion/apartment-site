<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pratham ‚Äî Laptop Terminal</title>
  <style>
    :root {
      --bg: #0b0e14;
      --panel: #0f131c;
      --text: #e6edf3;
      --muted: #9aa4b2;
      --accent: #7aa2ff;
      --ok: #5ac18e;
      --warn: #ffc36a;
      --err: #ff6b6b;
      --cursor: #7aa2ff;
      --link: #9fd0ff;
      --shadow: rgba(0,0,0,0.4);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    [data-theme="light"] {
      --bg: #f6f8fa;
      --panel: #ffffff;
      --text: #0a0c10;
      --muted: #6a737d;
      --accent: #316dca;
      --ok: #18794e;
      --warn: #b58402;
      --err: #d1242f;
      --cursor: #316dca;
      --link: #044289;
      --shadow: rgba(0,0,0,0.1);
    }
    html, body {
      height: 100%;
      background: radial-gradient(1200px 800px at 10% -10%, #151a24 0%, var(--bg) 45%);
      margin: 0;
      color: var(--text);
      font-family: var(--mono);
    }
    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .terminal {
      width: min(960px, 95vw);
      height: min(640px, 85vh);
      background: var(--panel);
      border-radius: 16px;
      box-shadow: 0 20px 60px var(--shadow), inset 0 0 0 1px rgba(255,255,255,0.04);
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow: hidden;
    }
    .titlebar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
    }
    .dots { display: flex; gap: 8px; margin-right: 8px;}
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot.red { background: #ff5f56; }
    .dot.yellow { background: #ffbd2e; }
    .dot.green { background: #27c93f; }
    .titlebar h1 { font-size: 14px; font-weight: 600; margin: 0; color: var(--muted); }
    .screen {
      padding: 16px;
      overflow: auto;
      line-height: 1.5;
      font-size: 14px;
    }
    .line { white-space: pre-wrap; word-break: break-word; }
    .line .prompt { color: var(--accent); }
    .line .ok { color: var(--ok); }
    .line .warn { color: var(--warn); }
    .line .err { color: var(--err); }
    .inputbar {
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: linear-gradient(0deg, rgba(255,255,255,0.03), transparent);
      position: relative;
    }
    .chevron { color: var(--accent); font-weight: 700; }
    #cmd {
      width: 100%;
      background: rgba(0,0,0,0.25);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
      caret-color: var(--cursor);
      font-family: var(--mono);
      font-size: 14px;
    }
    .hint {
      font-size: 12px;
      color: var(--muted);
      padding: 6px 14px 10px;
      border-top: 1px dashed rgba(255,255,255,0.08);
    }
    /* Autocomplete dropdown */
    .ac {
      position: absolute;
      bottom: 60px;
      left: 58px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      box-shadow: 0 12px 30px var(--shadow);
      overflow: hidden;
      display: none;
      max-height: 220px;
      width: 360px;
    }
    .ac.show { display: block; }
    .ac-item {
      padding: 8px 12px;
      display: flex;
      gap: 10px;
      align-items: baseline;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .ac-item:last-child { border-bottom: 0; }
    .ac-item .cmd { color: var(--accent); font-weight: 600; min-width: 110px; }
    .ac-item .desc { color: var(--muted); font-size: 12px; }
    .ac-item.active { background: rgba(122,162,255,0.08); }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .kbd { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); padding: 2px 6px; border-radius: 6px; font-size: 12px;}
    /* Matrix rain for /hack */
    .matrix {
      position: absolute; inset: 0; pointer-events: none; opacity: 0; transition: opacity .2s ease;
    }
    .matrix.show { opacity: 1; }
    canvas { display: block; width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div class="wrap" data-theme="dark">
    <div class="terminal" id="terminal">
      <div class="titlebar">
        <div class="dots">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>
        <h1>~/laptop ‚Äî interactive terminal</h1>
      </div>
      <div class="screen" id="screen" role="log" aria-live="polite"></div>

      <div class="inputbar">
        <span class="chevron">‚ùØ</span>
        <input id="cmd" type="text" autocomplete="off" spellcheck="false" placeholder="Type /help ‚Ä¶  (TAB to autocomplete)" />
        <div class="ac" id="ac"></div>
        <div class="matrix" id="matrix"><canvas id="matrixCanvas"></canvas></div>
      </div>

      <div class="hint">
        <span class="kbd">TAB</span> autocomplete ‚Ä¢ <span class="kbd">‚Üë/‚Üì</span> history ‚Ä¢ <span class="kbd">/help</span> for commands
      </div>
    </div>
  </div>

<script>
/* =========================
   Config / Data
========================= */

// About Me
const ABOUT_ME = "Hi, I am Pratham. I'm 22 years old and I'm currently studying to be a pharmacist. I enjoy playing basketball, video games, listening to music, drawing, and coding.";

// Links (replace with real URLs)
const LINKS = [
  { label: "Saginaw Discount Pharmacy", url: "https:/saginawdiscountpharmacy.com" },
  { label: "Euclid Pharmacy", url: "https://euclidpharmacy.com" },
  { label: "Brotherhood Pharmacy", url: "https://brotherhoodrx.com" },
  { label: "Autism Systems Foundation", url: "https://autismsystemsfoundation.com" }
];

// Contact (replace with real info)
const CONTACT = {
  email: "prathaminmotion@outlook.com",
  phone: "989-964-1453"
};

// Books ‚Äî one-dimensional array; numbering restarts per series
const BOOKS = [
  // Percy Jackson and the Olympians
  "1. The Lightning Thief ‚Äì Rick Riordan",
  "2. The Sea of Monsters ‚Äì Rick Riordan",
  "3. The Titan's Curse ‚Äì Rick Riordan",
  "4. The Battle of the Labyrinth ‚Äì Rick Riordan",
  "5. The Last Olympian ‚Äì Rick Riordan",

  // Heroes of Olympus
  "1. The Lost Hero ‚Äì Rick Riordan",
  "2. The Son of Neptune ‚Äì Rick Riordan",
  "3. The Mark of Athena ‚Äì Rick Riordan",
  "4. The House of Hades ‚Äì Rick Riordan",
  "5. The Blood of Olympus ‚Äì Rick Riordan",

  // Kane Chronicles
  "1. The Red Pyramid ‚Äì Rick Riordan",
  "2. The Throne of Fire ‚Äì Rick Riordan",
  "3. The Serpent's Shadow ‚Äì Rick Riordan",

  // Magnus Chase and the Gods of Asgard
  "1. The Sword of Summer ‚Äì Rick Riordan",
  "2. The Hammer of Thor ‚Äì Rick Riordan",
  "3. The Ship of the Dead ‚Äì Rick Riordan",

  // The Zodiac Legacy ‚Äì Stan Lee
  "1. Convergence ‚Äì Stan Lee",
  "2. The Dragon's Return ‚Äì Stan Lee",
  "3. The Balance of Power ‚Äì Stan Lee",

  // Harry Potter
  "1. Harry Potter and the Sorcerer‚Äôs Stone ‚Äì J.K. Rowling",
  "2. Harry Potter and the Chamber of Secrets ‚Äì J.K. Rowling",
  "3. Harry Potter and the Prisoner of Azkaban ‚Äì J.K. Rowling",
  "4. Harry Potter and the Goblet of Fire ‚Äì J.K. Rowling",
  "5. Harry Potter and the Order of the Phoenix ‚Äì J.K. Rowling",
  "6. Harry Potter and the Half-Blood Prince ‚Äì J.K. Rowling",
  "7. Harry Potter and the Deathly Hallows ‚Äì J.K. Rowling",

  // Wings of Fire
  "1. The Dragonet Prophecy ‚Äì Tui T. Sutherland",
  "2. The Lost Heir ‚Äì Tui T. Sutherland",
  "3. The Hidden Kingdom ‚Äì Tui T. Sutherland",
  "4. The Dark Secret ‚Äì Tui T. Sutherland",
  "5. The Brightest Night ‚Äì Tui T. Sutherland",
  "6. Moon Rising ‚Äì Tui T. Sutherland",
  "7. Winter Turning ‚Äì Tui T. Sutherland",
  "8. Escaping Peril ‚Äì Tui T. Sutherland",
  "9. Talons of Power ‚Äì Tui T. Sutherland",
  "10. Darkness of Dragons ‚Äì Tui T. Sutherland",
  "11. The Lost Continent ‚Äì Tui T. Sutherland",
  "12. The Hive Queen ‚Äì Tui T. Sutherland",
  "13. The Poison Jungle ‚Äì Tui T. Sutherland",
  "14. The Dangerous Gift ‚Äì Tui T. Sutherland",
  "15. The Flames of Hope ‚Äì Tui T. Sutherland",

  // Diary of a Wimpy Kid
  "1. Diary of a Wimpy Kid ‚Äì Jeff Kinney",
  "2. Rodrick Rules ‚Äì Jeff Kinney",
  "3. The Last Straw ‚Äì Jeff Kinney",
  "4. Dog Days ‚Äì Jeff Kinney",
  "5. The Ugly Truth ‚Äì Jeff Kinney",
  "6. Cabin Fever ‚Äì Jeff Kinney",
  "7. The Third Wheel ‚Äì Jeff Kinney",
  "8. Hard Luck ‚Äì Jeff Kinney",
  "9. The Long Haul ‚Äì Jeff Kinney",
  "10. Old School ‚Äì Jeff Kinney",
  "11. Double Down ‚Äì Jeff Kinney",
  "12. The Getaway ‚Äì Jeff Kinney",
  "13. The Meltdown ‚Äì Jeff Kinney",
  "14. Wrecking Ball ‚Äì Jeff Kinney",
  "15. The Deep End ‚Äì Jeff Kinney",
  "16. Big Shot ‚Äì Jeff Kinney",
  "17. Diper √ñverl√∂de ‚Äì Jeff Kinney",
  "18. No Brainer ‚Äì Jeff Kinney"
];

// Commands registry (for /help and autocomplete)
const COMMANDS = [
  { command: "/help", description: "Show available commands." },
  { command: "/clear", description: "Clear the terminal." },
  { command: "/about", description: "About Pratham." },
  { command: "/contact", description: "Email and phone." },
  { command: "/links", description: "Quick links (pharmacies + foundation)." },
  { command: "/echo", description: "Echo back your text. Usage: /echo hello" },
  { command: "/reading", description: "Show a random book from your list." },
  { command: "/fav-tech", description: "Favorite tech stack." },
  { command: "/game", description: "Start a number guessing game." },
  { command: "/theme", description: "Toggle theme (light/dark)." },
  { command: "/systeminfo", description: "Show browser/system info." },
  { command: "/keon", description: "Keon's backstory + Silent Hand manifesto." },
  { command: "/time", description: "Show current time/date." },
  { command: "/weather", description: "Get weather for a city. Usage: /weather City" },
  { command: "/calc", description: "Quick math. Usage: /calc 2+2*5" },
  { command: "/hack", description: "Fake hacking 'code rain' for a few seconds." }
];

/* =========================
   Terminal Helpers
========================= */
const screen = document.getElementById("screen");
const input = document.getElementById("cmd");
const acBox = document.getElementById("ac");
const wrapper = document.querySelector(".wrap");

const history = [];
let historyIndex = -1;
let gameState = null; // {active: bool, target: number, tries: number}

// Append a line to the terminal
function print(html, cls="") {
  const div = document.createElement("div");
  div.className = "line" + (cls ? " " + cls : "");
  div.innerHTML = html;
  screen.appendChild(div);
  screen.scrollTop = screen.scrollHeight;
}

function promptLine(cmd) {
  print(`<span class="prompt">pratham@laptop</span>:~$ ${escapeHTML(cmd ?? "")}`);
}

function escapeHTML(s) {
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

/* =========================
   Autocomplete
========================= */
let acItems = [];
let acActiveIndex = -1;

function updateAutocomplete() {
  const v = input.value.trim();
  if (!v.startsWith("/")) { acBox.classList.remove("show"); return; }

  const items = COMMANDS.filter(c => c.command.startsWith(v));
  acBox.innerHTML = "";
  acItems = items;
  acActiveIndex = 0;

  if (!items.length) { acBox.classList.remove("show"); return; }

  items.forEach((c, i) => {
    const row = document.createElement("div");
    row.className = "ac-item" + (i===0 ? " active" : "");
    row.innerHTML = `<span class="cmd">${c.command}</span><span class="desc">${c.description}</span>`;
    row.addEventListener("click", () => {
      input.value = c.command + " ";
      acBox.classList.remove("show");
      input.focus();
    });
    acBox.appendChild(row);
  });
  acBox.classList.add("show");
}

function moveAutocomplete(delta) {
  if (!acBox.classList.contains("show")) return;
  acActiveIndex = (acActiveIndex + delta + acItems.length) % acItems.length;
  [...acBox.children].forEach((el, i) => el.classList.toggle("active", i===acActiveIndex));
}

function acceptAutocomplete() {
  if (!acBox.classList.contains("show")) return;
  const choice = acItems[acActiveIndex];
  if (choice) {
    input.value = choice.command + " ";
    acBox.classList.remove("show");
  }
}

/* =========================
   Command Implementations
========================= */

function cmd_help() {
  const list = COMMANDS.map(c => `<span class="prompt">${c.command}</span> ‚Äì <span class="muted">${escapeHTML(c.description)}</span>`).join("<br>");
  print(list);
}

function cmd_clear() { screen.innerHTML = ""; }

function cmd_about() { print(escapeHTML(ABOUT_ME)); }

function cmd_contact() {
  print(`Email: <a href="mailto:${CONTACT.email}">${CONTACT.email}</a><br>Phone: ${CONTACT.phone}`);
}

function cmd_links() {
  print(LINKS.map(l => `‚Ä¢ <a href="${l.url}" target="_blank" rel="noopener noreferrer">${escapeHTML(l.label)}</a>`).join("<br>"));
}

function cmd_echo(args) { print(escapeHTML(args.join(" "))); }

function cmd_reading() {
  const pick = BOOKS[Math.floor(Math.random() * BOOKS.length)];
  print(`üìö ${escapeHTML(pick)}`);
}

function cmd_favtech() { print("C# and VS Code"); }

function cmd_theme() {
  const isLight = wrapper.getAttribute("data-theme")==="light";
  wrapper.setAttribute("data-theme", isLight ? "dark" : "light");
  print(`Theme set to <span class="ok">${isLight ? "dark" : "light"}</span>.`);
}

function cmd_systeminfo() {
  const n = navigator;
  const info = [
    `User Agent: ${n.userAgent}`,
    `Platform: ${n.platform}`,
    `Language: ${n.language}`,
    `Cores: ${n.hardwareConcurrency ?? "n/a"}`,
    `Memory (GB approx): ${n.deviceMemory ?? "n/a"}`,
    `Screen: ${window.screen.width}x${window.screen.height}`,
    `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`
  ].join("<br>");
  print(info);
}

function cmd_time() {
  const now = new Date();
  print(now.toLocaleString());
}

async function cmd_weather(args) {
  if (!args.length) {
    print(`<span class="warn">Usage:</span> /weather City  (e.g., /weather Detroit)`);
    return;
  }
  const city = args.join(" ");
  try {
    // Geocode with Open-Meteo (no API key)
    const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`).then(r=>r.json());
    if (!geo.results || !geo.results.length) { print(`<span class="err">City not found.</span>`); return; }
    const { latitude, longitude, name, country } = geo.results[0];
    const wx = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m`).then(r=>r.json());
    const c = wx.current;
    if (!c) { print(`<span class="err">Weather unavailable.</span>`); return; }
    const codeMap = {
      0: "Clear", 1:"Mainly clear", 2:"Partly cloudy", 3:"Overcast",
      45:"Fog", 48:"Fog", 51:"Light drizzle", 53:"Drizzle", 55:"Heavy drizzle",
      61:"Light rain", 63:"Rain", 65:"Heavy rain", 71:"Light snow", 73:"Snow", 75:"Heavy snow",
      80:"Rain showers", 81:"Rain showers", 82:"Heavy showers", 95:"Thunderstorm", 96:"Thunderstorm", 99:"Thunderstorm"
    };
    print(`üå§Ô∏è <b>${name}, ${country}</b><br>
      Temp: ${c.temperature_2m}¬∞C (feels ${c.apparent_temperature}¬∞C)<br>
      Humidity: ${c.relative_humidity_2m}% ‚Ä¢ Wind: ${c.wind_speed_10m} m/s<br>
      Precip: ${c.precipitation ?? 0} mm ‚Ä¢ Conditions: ${codeMap[c.weather_code] ?? "‚Äî"}`);
  } catch (e) {
    print(`<span class="err">Weather fetch failed.</span>`);
  }
}

function cmd_calc(args) {
  const expr = args.join(" ");
  if (!expr) { print(`<span class="warn">Usage:</span> /calc 2+2*5`); return; }
  // Safe-ish eval: only numbers, operators, parentheses, decimal, spaces, ^ for pow -> **
  const cleaned = expr.replace(/\^/g, "**");
  if (!/^[0-9+\-*/().\s%**]+$/.test(cleaned)) { print(`<span class="err">Invalid characters.</span>`); return; }
  try {
    // eslint-disable-next-line no-new-func
    const result = Function(`"use strict"; return (${cleaned});`)();
    print(`<span class="ok">${expr} = ${result}</span>`);
  } catch {
    print(`<span class="err">Bad expression.</span>`);
  }
}

function cmd_game(args) {
  if (!gameState || !gameState.active) {
    gameState = { active: true, target: Math.floor(Math.random()*100)+1, tries: 0 };
    print("üéØ Guess a number 1‚Äì100. Type: /game 50  (use /game quit to stop)");
    return;
  }
  if (args[0] && args[0].toLowerCase()==="quit") {
    gameState.active = false; print("Game ended."); return;
  }
  const guess = Number(args[0]);
  if (!Number.isFinite(guess)) { print(`<span class="warn">Enter a number, e.g., /game 42</span>`); return; }
  gameState.tries++;
  if (guess === gameState.target) {
    print(`<span class="ok">Correct!</span> You got it in ${gameState.tries} tries.`);
    gameState.active = false;
  } else {
    print(guess < gameState.target ? "Higher ‚Üë" : "Lower ‚Üì");
  }
}

function cmd_keon() {
  const txt = `Keon ‚Äî Monk of Peace (Leboros)

Backstory:
Keon believed peace could tame a violent world. Manipulated into corruption, he wandered from Leboros, mistaking control for order. After a hard reckoning, he learned true peace is not silence but reconciliation.

Silent Hand Manifesto:
1) Protect the powerless first. Mercy is our opening move.
2) Expose the rot: truth delivered plainly, without spectacle.
3) Break cycles: forgive, then rebuild institutions to prevent repeat harm.
4) Strength with restraint: we fight only to stop the fight.
5) Redemption is policy: every door stays cracked for return.

Methods:
‚Äî Shields before swords, sanctuary corridors, non-lethal first, decisive last.
‚Äî Wealth flows outward: tithe victories to feed, heal, and house.
‚Äî Speak softly, stand immovable.`;
  print(escapeHTML(txt));
}

function cmd_hack() {
  startMatrixRain(4000); // 4 seconds
  print(`<span class="warn">Initializing sequence‚Ä¶</span>`);
  setTimeout(() => print(`<span class="ok">ACCESS GRANTED</span>`), 4200);
}

/* =========================
   Matrix Rain Effect (/hack)
========================= */
const matrixWrap = document.getElementById("matrix");
const canvas = document.getElementById("matrixCanvas");
const ctx = canvas.getContext("2d");
let rainTimer = null;

function startMatrixRain(ms=4000) {
  resizeCanvas();
  matrixWrap.classList.add("show");
  const letters = "„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥ÔΩ±ÔΩ≤ÔΩ≥ÔΩ¥ÔΩµÔΩ∂ÔΩ∑ÔΩ∏ÔΩπÔΩ∫01ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&*+-/<=>";
  const fontSize = 14;
  const columns = Math.floor(canvas.width / fontSize);
  const drops = Array(columns).fill(1);

  if (rainTimer) cancelAnimationFrame(rainTimer);

  (function draw() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.08)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#7aa2ff";
    ctx.font = fontSize + "px monospace";
    for (let i=0; i<drops.length; i++) {
      const text = letters.charAt(Math.floor(Math.random() * letters.length));
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);
      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
    rainTimer = requestAnimationFrame(draw);
  })();

  setTimeout(() => {
    matrixWrap.classList.remove("show");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    cancelAnimationFrame(rainTimer);
    rainTimer = null;
  }, ms);
}

function resizeCanvas() {
  const rect = matrixWrap.getBoundingClientRect();
  canvas.width = rect.width; canvas.height = rect.height;
}
window.addEventListener("resize", () => { if (matrixWrap.classList.contains("show")) resizeCanvas(); });

/* =========================
   Dispatcher
========================= */
const handlers = {
  "/help": () => cmd_help(),
  "/clear": () => cmd_clear(),
  "/about": () => cmd_about(),
  "/contact": () => cmd_contact(),
  "/links": () => cmd_links(),
  "/echo": args => cmd_echo(args),
  "/reading": () => cmd_reading(),
  "/fav-tech": () => cmd_favtech(),
  "/game": args => cmd_game(args),
  "/theme": () => cmd_theme(),
  "/systeminfo": () => cmd_systeminfo(),
  "/keon": () => cmd_keon(),
  "/time": () => cmd_time(),
  "/weather": args => cmd_weather(args),
  "/calc": args => cmd_calc(args),
  "/hack": () => cmd_hack()
};

/* =========================
   Boot + Input Events
========================= */
function boot() {
  print("Welcome, Pratham. Type /help to see commands.");
  promptLine("");
}
boot();

input.addEventListener("input", updateAutocomplete);

input.addEventListener("keydown", (e) => {
  // History
  if (e.key === "ArrowUp") {
    e.preventDefault();
    if (history.length) {
      historyIndex = Math.max(0, historyIndex === -1 ? history.length - 1 : historyIndex - 1);
      input.value = history[historyIndex];
      updateAutocomplete();
    }
  } else if (e.key === "ArrowDown") {
    e.preventDefault();
    if (history.length) {
      if (historyIndex === -1 || historyIndex === history.length - 1) {
        historyIndex = -1; input.value = "";
      } else {
        historyIndex++;
        input.value = history[historyIndex];
      }
      updateAutocomplete();
    }
  } else if (e.key === "Tab") {
    e.preventDefault();
    acceptAutocomplete();
  } else if (e.key === "Enter") {
    const raw = input.value.trim();
    acBox.classList.remove("show");
    if (!raw) return;

    history.push(raw);
    historyIndex = -1;

    promptLine(raw);
    runCommand(raw);

    input.value = "";
  } else if (e.key === "Escape") {
    acBox.classList.remove("show");
  }
});

function runCommand(raw) {
  const [cmd, ...args] = raw.split(/\s+/);
  const fn = handlers[cmd?.toLowerCase()];
  if (fn) {
    try { fn(args); } catch (e) { print(`<span class="err">Command error.</span>`); }
  } else {
    print(`<span class="err">Unknown command:</span> ${escapeHTML(cmd)} (try /help)`);
  }
}

/* =========================
   Initial Focus
========================= */
setTimeout(() => input.focus(), 200);

</script>
</body>
</html>
