<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Room for Growth</title>

  <style>
    /* ==========================
       Reset & Base
    ========================== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%}
    body{
      background: var(--bg, #0f1114);
      color: var(--text, #eaeef5);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.35;
      transition: background .45s ease, color .45s ease;
    }

    /* ==========================
       Theme vars (shifted by day/night state)
    ========================== */
    :root{
      --bg:#0f1114;
      --panel:#1a1d24;
      --text:#eaeef5;
      --muted:#a8b0bf;
      --accent:#7dd3fc; /* soft neon blue */
      --overlay-opa: 0;         /* lighting intensity */
      --overlay-grad: radial-gradient(60% 60% at 75% 25%, rgba(255,210,130,.0) 0%, rgba(255,180,90,.0) 40%, rgba(0,0,0,.0) 60%);
      --vignette-opa: 0;        /* vignette at night */

      /* TV positioning knobs (percentages tuned to tv.png) */
      --tv-screen-left: 12.4%;
      --tv-screen-top: 31.9%;
      --tv-screen-width: 74.2%;
      --tv-screen-height: 43.7%;

      /* On-screen UI tuning */
      --tv-ui-scale: 0.90;      /* lower = smaller (0.88–0.95 is a good range) */
      --tv-safe-bottom: 10px;   /* extra breathing room below the card */
    }
    [data-theme="dawn"]{
      --bg:#0e1116; --panel:#171b21; --accent:#8be3ff;
      --overlay-opa:.25; --overlay-grad: linear-gradient(180deg, rgba(150,200,255,.12), rgba(255,200,140,.10)); --vignette-opa:.08;
    }
    [data-theme="day"]{
      --bg:#0e1014; --panel:#171b21; --accent:#7dd3fc;
      --overlay-opa:.12; --overlay-grad: linear-gradient(180deg, rgba(140,200,255,.10), rgba(140,200,255,.06)); --vignette-opa:.05;
    }
    [data-theme="dusk"]{
      --bg:#0e0f12; --panel:#17181e; --accent:#87c8ff;
      --overlay-opa:.35; --overlay-grad: radial-gradient(60% 60% at 80% 20%, rgba(255,170,120,.35), rgba(0,0,0,0) 60%); --vignette-opa:.14;
    }
    [data-theme="night"]{
      --bg:#0a0c10; --panel:#14161a; --accent:#6ec1ff;
      --overlay-opa:.45; --overlay-grad: linear-gradient(180deg, rgba(30,60,120,.28), rgba(10,20,40,.32)); --vignette-opa:.22;
    }

    /* ==========================
       Room container & image + lighting
    ========================== */
    #room-container{position:relative; text-align:center; max-width:1536px; margin:0 auto;}
    #room-image{max-width:100%; height:auto; display:block; margin:0 auto; user-select:none}

    .lighting,.vignette{position:absolute; inset:0; pointer-events:none; z-index:1; opacity:var(--overlay-opa); transition: opacity .6s ease;}
    .lighting{ background: var(--overlay-grad); mix-blend-mode: soft-light; }
    .vignette{ opacity:var(--vignette-opa); background: radial-gradient(130% 130% at 50% 60%, rgba(0,0,0,0) 55%, rgba(0,0,0,0.55) 100%); mix-blend-mode: multiply; }

    /* ==========================
       Dots
    ========================== */
    .dot{ position:absolute; z-index:2; width:16px; height:16px; border-radius:50%; border:2px solid rgba(255,255,255,0.85); background: rgba(255,255,255,0.22); transform: translate(-50%, -50%); cursor:pointer; transition: background .25s ease, transform .2s ease, box-shadow .2s ease; outline: none; }
    .dot:hover,.dot:focus-visible{ background:#fff; transform: translate(-50%, -50%) scale(1.35); box-shadow: 0 6px 16px rgba(0,0,0,.45), 0 0 18px rgba(125,211,252,.55); }
    .dot::after{ content: attr(data-label); position:absolute; bottom:135%; left:50%; transform:translateX(-50%); background: rgba(0,0,0,0.75); color:#fff; padding:2px 6px; border-radius:4px; font-size:12px; white-space:nowrap; opacity:0; transition:opacity .15s ease; pointer-events:none; }
    .dot:hover::after,.dot:focus-visible::after{opacity:1}

    /* Dot positions (center of each item, responsive %) for 1536x1024 base */
    .dot-laptop    { left: 59.52%;  top: 45.41%; }
    .dot-window    { left: 61.70%;  top: 24.69%; }
    .dot-mirror    { left: 86.39%;  top: 32.24%; }
    .dot-bookshelf { left: 80.88%;  top: 53.88%; }
    .dot-desk      { left: 59.66%;  top: 56.02%; }
    .dot-tv        { left: 32.79%;  top: 41.53%; }
    .dot-art       { left: 32.11%;  top: 20.61%; }
    .dot-clothes   { left: 17.82%;  top: 35.51%; }
    .dot-bed       { left: 18.10%;  top: 85.51%; }
    .dot-vault { left: 10.42%; top: 63.57%; width: 16px; height: 16px; background: transparent !important; border: none !important; cursor: pointer; }

    /* ==========================
       Base Modal (reused by zones, bookshelf, TV)
    ========================== */
    #content-modal{ position:fixed; inset:0; background:rgba(0,0,0,.78); display:none; justify-content:center; align-items:center; z-index:1000; animation: fadeInOverlay .3s ease-out; }
    #modal-box{
      background: var(--panel); color: var(--text);
      padding: 1.25rem 1.25rem 1rem; border-radius: 12px;
      width: min(96vw, 1200px);
      position:relative; box-shadow: 0 10px 30px rgba(0,0,0,.55); animation: slideIn .28s ease-out;
    }
    #close-btn{ position:absolute; top:.5rem; right:.6rem; background:none; border:1px solid rgba(255,255,255,.12); color:var(--text); font-size:1.25rem; line-height:1; border-radius:8px; padding:.2rem .5rem; cursor:pointer; }
    #modal-content{ margin-top:.75rem; line-height:1.55; color:var(--text); }

    @keyframes fadeInOverlay{ from{opacity:0} to{opacity:1} }
    @keyframes slideIn{ from{ transform: translateY(-14px); opacity:0 } to{ transform:none; opacity:1 } }

    @media (prefers-reduced-motion: reduce){ *{ transition:none !important; animation:none !important } }

    /* ==========================
       Bookshelf modal bits
    ========================== */
    .book-cover{ width:120px; aspect-ratio:2/3; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.25)), linear-gradient(180deg,#6b58a9,#3f356f); box-shadow:0 10px 18px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.28); position:relative; flex:0 0 auto; }
    .book-cover::after{ content:""; position:absolute; left:8px; top:8px; bottom:8px; width:4px; border-radius:3px; background:linear-gradient(180deg, rgba(255,255,255,.4), rgba(255,255,255,.1)); }
    .book-head{ display:flex; gap:14px; align-items:flex-start }
    .book-title{ margin:.2rem 0 .2rem; font-weight:700; font-size:1.15rem }
    .book-sub{ color:var(--muted); margin-bottom:.45rem }
    .book-syn{ color:#e7dec7; line-height:1.4 }
    .book-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px }
    .book-btn, .book-chip{ background:#0f141e; color:#dce6ff; border:1px solid #243049; border-radius:10px; padding:8px 12px; cursor:pointer; }
    .book-chip{ background:#e9c46a; color:#3b2f1e; border:none }
    .list-wrap{ margin-top:12px; display:none; }
    .list-wrap.show{ display:block; }
    .list-controls{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:8px }
    .list-controls select, .list-controls input{ background:#0f141e; color:#dbe4f6; border:1px solid #243049; border-radius:10px; padding:8px 10px; }
    .series-list{ max-height:56vh; overflow:auto; padding-right:6px }
    .series-group{ margin:10px 0 14px; }
    .series-title{ font-weight:700; color:#f2ead3; background:#1a1f28; border:1px solid #2a3344; padding:6px 10px; border-radius:8px; position:sticky; top:0; }
    .book-item{ display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-bottom:1px solid #1f2837; color:#eaeef5; }
    .book-item small{ color:#a9b6cf }

    /* ==========================
       Retro TV — image-driven shell with layered screen
       Uses tv.png. Content is placed in .tv-screen.
    ========================== */
    .tv-wrap{ display:grid; grid-template-columns: 1fr 300px; gap:18px; align-items:stretch; }

    .tv-shell{ position:relative; width:min(90vw, 820px); aspect-ratio:1/1; background:url('tv.png') center/contain no-repeat; border-radius:20px; filter: drop-shadow(0 14px 34px rgba(0,0,0,.5)); }

    .tv-screen{
      position:absolute;
      left:var(--tv-screen-left);
      top:var(--tv-screen-top);
      width:var(--tv-screen-width);
      height:var(--tv-screen-height);
      overflow:hidden;
      border-radius:18px;
      background:#0a0c10;
      box-shadow:
        inset 0 0 90px rgba(0,0,0,.75),
        inset 0 0 6px rgba(120,180,255,.25);
    }

    /* Glass & scanline effects */
    .tv-glass:before{ content:""; position:absolute; inset:0; background: radial-gradient(90% 70% at 50% 35%, rgba(255,255,255,.08), transparent 60%), repeating-linear-gradient(180deg, rgba(255,255,255,.04) 0 2px, rgba(0,0,0,.04) 2px 4px); mix-blend-mode:soft-light; pointer-events:none; }

    /* Screen layout */
    .screen-inner{
      position:absolute; inset:0; padding:12px;
      display:grid; grid-template-rows:auto auto 1fr; gap:10px; color:#eaeef5;

      /* uniformly shrink everything on the screen */
      transform: scale(var(--tv-ui-scale));
      transform-origin: top left;
      padding-bottom: calc(12px + var(--tv-safe-bottom));
    }

    /* little room between tabs and card */
    .remote-row{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }

    .screen-head{ position:relative; display:flex; align-items:center; gap:10px; }
    .ch-badge{ margin-left:auto; background: rgba(0,0,0,.55); color:#eaeef5; border:1px solid rgba(255,255,255,.15); font-size:12px; padding:4px 8px; border-radius:999px; }
    .tv-h1{ font-weight:800; font-size:1rem; margin:0; }
    .tv-sub{ color:#cfd9f0; margin:0; font-size:.9rem; }

    .pill{ background:#232a39; border:1px solid #32405a; color:#dce6ff; border-radius:999px; padding:6px 10px; cursor:pointer; font-size:.85rem; }
    .pill.active{ background:#e9c46a; color:#2f2618; border-color:#e9c46a }

    /* Body area fills the remaining space */
    .screen-body{ position:relative; min-height:0; overflow:hidden; }

    .card{
      display:flex; gap:10px; align-items:flex-start;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      padding:8px;
    }
    .poster{
      width:60px; aspect-ratio:2/3; border-radius:10px; flex:0 0 auto;
      background:
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.25)),
        linear-gradient(180deg,#8c76cb,#5b4f90);
      box-shadow:0 10px 18px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.28);
    }
    .title{ font-weight:700; margin-bottom:4px; font-size:.95rem; }
    .desc{ color:#e7dec7; font-size:.9rem; line-height:1.35; }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
    .btn{ background:#0f141e; color:#dce6ff; border:1px solid #243049; border-radius:10px; padding:6px 10px; cursor:pointer; }
    .btn:active{ transform:translateY(1px) }

    /* Guide fills screen-body and scrolls; card hidden while guide shown */
    .guide{ position:absolute; inset:0; display:none; }
    .guide.show{ display:block; }
    .grid{ position:absolute; inset:44px 0 0 0; overflow:auto; display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); gap:10px; padding-right:4px; }
    .item{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:10px; border-radius:10px }
    .item .num{ color:#a9b6cf; font-size:.9rem }

    /* Channel-change FX */
    .static,.wipe{ position:absolute; inset:0; pointer-events:none; opacity:0; }
    .static{ background: repeating-conic-gradient(from 0deg, rgba(255,255,255,.07) 0 6deg, rgba(0,0,0,.07) 6deg 12deg), repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 3px, rgba(0,0,0,.03) 3px 6px); }
    .wipe{ background:linear-gradient(0deg, transparent, rgba(255,255,255,.9), transparent); }
    .flip .static{ animation: fuzz .35s steps(14) forwards }
    .flip .wipe{ animation: wipeDown .35s ease-out forwards }
    @keyframes fuzz{ 0%{opacity:1; transform:scale(1.02)} 90%{opacity:.9} 100%{opacity:0; transform:scale(1)} }
    @keyframes wipeDown{ 0%{opacity:1; transform:translateY(-100%)} 100%{opacity:0; transform:translateY(100%)} }

    /* Remote look & feel */
    .controls{ align-self:stretch; width:300px; display:flex; flex-direction:column; gap:14px; background: linear-gradient(180deg, #161a22, #0e1117); border:1px solid rgba(255,255,255,.08); border-radius:28px; padding:16px; box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 10px 24px rgba(0,0,0,.42); }
    .remote-top{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }
    .btn-round{ width:44px; height:44px; border-radius:999px; border:1px solid #32405a; background:#232a39; color:#dce6ff; cursor:pointer; box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 2px 8px rgba(0,0,0,.35);}
    .btn-round:active{ transform:translateY(1px);}
    .remote-section{ background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .knob{ background: linear-gradient(180deg, #2a2f3a, #1a1f28); color:#d9e6ff; border:1px solid #313c52; border-radius:14px; padding:10px 12px; text-align:left; cursor:pointer; width:100%; }
    .knob + .knob{ margin-top:8px;}
    .knob.active{ outline:2px solid var(--accent); outline-offset:2px }
    .remote-nav{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .remote-key{ background:#232a39; border:1px solid #32405a; color:#dce6ff; border-radius:12px; padding:10px 0; text-align:center; cursor:pointer; box-shadow: inset 0 1px 0 rgba(255,255,255,.06);}
    .remote-key:active{ transform:translateY(1px);}

    /* Mobile: stack TV over controls */
    @media (max-width: 900px){
      .tv-wrap{ grid-template-columns: 1fr; }
      .controls{ order:2; width:auto; }
      .tv-shell{ order:1; width:min(96vw, 680px); }
    }
  </style>
</head>
<body data-theme="day">
  <main id="room-container" aria-label="Interactive apartment room">
    <img id="room-image" src="room.png" alt="Interactive apartment room" draggable="false" />

    <!-- Lighting layers -->
    <div class="lighting" aria-hidden="true"></div>
    <div class="vignette" aria-hidden="true"></div>

    <!-- Floating dots -->
    <span class="dot dot-bed"        data-zone="bed"        data-label="Bed"        role="button" tabindex="0" aria-label="Open Bed"></span>
    <span class="dot dot-clothes"    data-zone="clothes"    data-label="Closet"     role="button" tabindex="0" aria-label="Open Closet"></span>
    <span class="dot dot-vault"      data-zone="vault"      data-label="Vault"      role="button" tabindex="0" aria-label="Open Vault"></span>
    <span class="dot dot-tv"         data-zone="tv"         data-label="TV"         role="button" tabindex="0" aria-label="Open TV"></span>
    <span class="dot dot-art"        data-zone="art"        data-label="Artwork"    role="button" tabindex="0" aria-label="Open Artwork"></span>
    <span class="dot dot-window"     data-zone="window"     data-label="Window"     role="button" tabindex="0" aria-label="Open Window"></span>
    <span class="dot dot-laptop"     data-zone="laptop"     data-label="Laptop"     role="button" tabindex="0" aria-label="Open Laptop"></span>
    <span class="dot dot-desk"       data-zone="desk"       data-label="Desk"       role="button" tabindex="0" aria-label="Open Desk"></span>
    <span class="dot dot-bookshelf"  data-zone="bookshelf"  data-label="Bookshelf"  role="button" tabindex="0" aria-label="Open Bookshelf"></span>
    <span class="dot dot-mirror"     data-zone="mirror"     data-label="Mirror"     role="button" tabindex="0" aria-label="Open Mirror"></span>
  </main>

  <!-- Modal -->
  <div id="content-modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div id="modal-box" role="document">
      <button id="close-btn" aria-label="Close">&times;</button>
      <div id="modal-content">Placeholder</div>
    </div>
  </div>

  <script>
    /* ==========================
       NON-BOOKSHELF BASE CONTENT
    ========================== */
    const CONTENT = {
      bed:     "🛏️ Your personal bed zone. Swap in dream logs or comfort items.",
      clothes: "👕 Closet: favorite outfits or style moodboard.",
      vault:   "🔐 Secret vault: hidden notes or unreleased ideas.",
      tv:      "", // handled via openTvModal()
      art:     "🖼 Inspiration wall or moodboard.",
      window:  "🌇 Daily view or travel inspiration.",
      desk:    "🗂 Project hub: portfolio tiles and progress.",
      mirror:  "🪞 Reflection prompts or a short bio."
    };

    const dots = document.querySelectorAll('.dot');
    const modal = document.getElementById('content-modal');
    const contentEl = document.getElementById('modal-content');
    const closeBtn = document.getElementById('close-btn');

    function themeForHour(h){
      if (h >= 5.5 && h < 7.5) return 'dawn';
      if (h >= 7.5 && h < 17.5) return 'day';
      if (h >= 17.5 && h < 20.5) return 'dusk';
      return 'night';
    }
    function applyTheme(){
      const now = new Date();
      const hour = now.getHours() + now.getMinutes()/60;
      document.body.setAttribute('data-theme', themeForHour(hour));
    }
    applyTheme();
    setInterval(applyTheme, 15*60*1000);

    function openZone(zone){
      if (zone === 'laptop') { window.location.href = 'laptop.html'; return; }
      if (zone === 'bookshelf') { openBookshelfModal(); return; }
      if (zone === 'tv') { openTvModal(); return; }

      const text = CONTENT[zone] || `No content for "${zone}".`;
      contentEl.textContent = text;
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      closeBtn.focus();
    }

    dots.forEach(dot=>{
      dot.addEventListener('click', ()=> openZone(dot.getAttribute('data-zone')));
      dot.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openZone(dot.getAttribute('data-zone')); }
      });
    });

    function hideModal(){
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
    }
    closeBtn.addEventListener('click', hideModal);
    modal.addEventListener('click', e => { if (e.target === modal) hideModal(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape' && modal.style.display === 'flex') hideModal(); });

    const vault = document.querySelector('.dot-vault');
    if (vault){
      vault.addEventListener('focus-visible', ()=>{ vault.style.outline = '2px dashed rgba(255,255,255,.5)'; vault.style.outlineOffset='2px'; });
      vault.addEventListener('blur', ()=>{ vault.style.outline = 'none'; });
    }

    /* ==========================
       BOOKSHELF MODAL
    ========================== */
    const SERIES = [
      {
        id:"hp", series:"Harry Potter", author:"J.K. Rowling",
        synopsis:"A boy wizard and his friends come of age at Hogwarts while confronting the return of Lord Voldemort.",
        books:[
          {title:"Harry Potter and the Sorcerer's Stone", no:1},
          {title:"Harry Potter and the Chamber of Secrets", no:2},
          {title:"Harry Potter and the Prisoner of Azkaban", no:3},
          {title:"Harry Potter and the Goblet of Fire", no:4},
          {title:"Harry Potter and the Order of the Phoenix", no:5},
          {title:"Harry Potter and the Half-Blood Prince", no:6},
          {title:"Harry Potter and the Deathly Hallows", no:7},
        ]
      },
      {
        id:"pjo", series:"Percy Jackson & the Olympians", author:"Rick Riordan",
        synopsis:"A modern demigod discovers his heritage and embarks on mythic quests to keep the gods from war.",
        books:[
          {title:"The Lightning Thief", no:1},
          {title:"The Sea of Monsters", no:2},
          {title:"The Titan's Curse", no:3},
          {title:"The Battle of the Labyrinth", no:4},
          {title:"The Last Olympian", no:5},
        ]
      },
      {
        id:"wof", series:"Wings of Fire (Arc 1)", author:"Tui T. Sutherland",
        synopsis:"Five dragonets foretold to end a brutal war must decide whether to follow prophecy or forge their own path.",
        books:[
          {title:"The Dragonet Prophecy", no:1},
          {title:"The Lost Heir", no:2},
          {title:"The Hidden Kingdom", no:3},
          {title:"The Dark Secret", no:4},
          {title:"The Brightest Night", no:5},
        ]
      },
      {
        id:"wimpy", series:"Diary of a Wimpy Kid", author:"Jeff Kinney",
        synopsis:"Greg Heffley’s illustrated journals turn middle-school mishaps into deadpan comedy.",
        books:[
          {title:"Diary of a Wimpy Kid", no:1},
          {title:"Rodrick Rules", no:2},
          {title:"The Last Straw", no:3},
          {title:"Dog Days", no:4},
          {title:"The Ugly Truth", no:5},
        ]
      }
    ];
    const EXTRAS = [
      {series:"Big Nate", author:"Lincoln Peirce", synopsis:"A wisecracking sixth-grader turns everyday chaos into laugh-out-loud adventures.",
       books:[{title:"Big Nate: In a Class by Himself",no:1},{title:"Big Nate Strikes Again",no:2},{title:"Big Nate on a Roll",no:3}]},
      {series:"Jurassic Park", author:"Michael Crichton", synopsis:"A biotech breakthrough resurrects dinosaurs, proving nature and hubris are a lethal mix.",
       books:[{title:"Jurassic Park",no:1},{title:"The Lost World",no:2}]}
    ];
    const ALL_SERIES = [...SERIES, ...EXTRAS];
    const rnd = arr => arr[Math.floor(Math.random()*arr.length)];

    function openBookshelfModal(seriesId=null){
      const S = seriesId ? ALL_SERIES.find(s=>s.id===seriesId) : rnd(ALL_SERIES);
      const pick = rnd(S.books);

      contentEl.innerHTML = `
        <div class="book-head">
          <div class="book-cover" id="book-cover"></div>
          <div>
            <div class="book-title">${pick.title}</div>
            <div class="book-sub">by ${S.author} • #${pick.no} in ${S.series}</div>
            <p class="book-syn">${S.synopsis}</p>
            <div class="book-row">
              <button class="book-btn" id="btn-another" title="Click: any series • Shift+Click: same series">🎲 Another random</button>
              <button class="book-chip" id="btn-all">All books</button>
            </div>

            <div class="list-wrap" id="books-list">
              <div class="list-controls">
                <label>Sort:
                  <select id="lst-sort">
                    <option value="title">Title (A→Z)</option>
                    <option value="author">Author (A→Z)</option>
                  </select>
                </label>
                <input id="lst-filter" placeholder="Search…">
                <button class="book-btn" id="btn-back">Back</button>
              </div>
              <div class="series-list" id="series-list"></div>
            </div>
          </div>
        </div>
      `;

      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');

      const cover = document.getElementById('book-cover');
      cover.style.filter = `hue-rotate(${Math.floor(Math.random()*360)}deg)`;

      document.getElementById('btn-another').addEventListener('click', (e)=>{
        if(e.shiftKey){ openBookshelfModal(S.id); } else { openBookshelfModal(null); }
      });

      const listWrap = document.getElementById('books-list');
      document.getElementById('btn-all').onclick = ()=>{ listWrap.classList.add('show'); renderSections() };
      document.getElementById('btn-back').onclick = ()=> listWrap.classList.remove('show');

      function renderSections(){
        const sortSel = document.getElementById('lst-sort');
        const filterEl = document.getElementById('lst-filter');
        const host = document.getElementById('series-list');

        function draw(){
          const q = (filterEl.value||'').toLowerCase();
          host.innerHTML = '';
          const key = sortSel.value;
          [...ALL_SERIES].forEach(series=>{
            const items = series.books
              .map(b => ({...b, series: series.series, author: series.author}))
              .filter(r => !q || r.title.toLowerCase().includes(q) || r.author.toLowerCase().includes(q) || r.series.toLowerCase().includes(q))
              .sort((a,b)=> String(a[key]).localeCompare(String(b[key])));
            if(!items.length) return;
            const group = document.createElement('div');
            group.className = 'series-group';
            group.innerHTML = `<div class="series-title">${series.series} <small>by ${series.author}</small></div>`;
            items.forEach(r=>{
              const row = document.createElement('div');
              row.className = 'book-item';
              row.innerHTML = `<span>${r.title}</span><small>#${r.no} — ${r.author}</small>`;
              group.appendChild(row);
            });
            host.appendChild(group);
          });
        }
        document.getElementById('lst-sort').onchange = draw;
        document.getElementById('lst-filter').oninput = draw;
        draw();
      }
    }

    /* ==========================
       TV MODAL: CRT + remote + channel surfing
    ========================== */
    const TV_DATA = {
      movies: {
        subTabs: [
          {
            id:'alltime', name:'All-Time Top 10', items: [
              {title:'Interstellar', desc:'A father ventures through space and time to save humanity’s future.'},
              {title:'Inception', desc:'A skilled thief enters dreams to plant an idea deep in a target’s mind.'},
              {title:'Madagascar', desc:'Zoo animals escape to the wild and discover life beyond their cage.'},
              {title:'Iron Man (2008)', desc:'A billionaire builds a suit of armor to fight his own weapons.'},
              {title:'Knives Out', desc:'A witty detective unravels a twisted family murder mystery.'},
              {title:'Avengers', desc:'Earth’s mightiest heroes unite to stop an alien invasion.'},
              {title:'Tower Heist', desc:'Employees plot revenge on the mogul who swindled them.'},
              {title:'Se7en', desc:'Detectives hunt a killer who follows the seven deadly sins.'},
              {title:'Sinners', desc:'A gritty crime tale about choices and consequences.'},
              {title:'The Dark Knight', desc:'Batman faces a moral trial against the Joker’s chaos.'},
            ]
          },
          {
            id:'indian', name:'Indian Top 5', items: [
              {title:'Housefull 3', desc:'Three men try to prove they deserve love and family approval.'},
              {title:'3 Idiots', desc:'Friendship and purpose collide in a college coming-of-age.'},
              {title:'Krrish', desc:'A man discovers his superhuman legacy—and a destiny to protect.'},
              {title:'Hera Pheri', desc:'A get-rich-quick scheme spirals into hilarious chaos.'},
              {title:'Aankhen', desc:'A daring bank heist executed by an unlikely team.'},
            ]
          }
        ]
      },
      shows: {
        items: [
          {title:'Brooklyn Nine-Nine', desc:'A quirky precinct solves crimes and cracks jokes.'},
          {title:'Game of Thrones', desc:'Noble houses clash for the Iron Throne.'},
          {title:'Breaking Bad', desc:'A chemistry teacher enters the criminal underworld.'},
          {title:'Modern Family', desc:'A loving, chaotic family navigates life together.'},
          {title:'How I Met Your Mother', desc:'A winding tale of love, friendship, and fate.'},
        ]
      },
      cartoons: {
        items: [
          {title:'Fullmetal Alchemist', desc:'Brothers use alchemy to fix what was lost.'},
          {title:'Invincible', desc:'A young hero confronts shocking truths.'},
          {title:'Attack on Titan', desc:'Humanity fights giants behind towering walls.'},
          {title:'Naruto', desc:'A boy ninja dreams of becoming Hokage.'},
          {title:'Super Hero Squad Show', desc:'Marvel heroes team up for lighthearted fun.'},
        ]
      },
      youtube: {
        items: [
          {title:'Poet Plays', desc:'Story-driven gaming with community vibes.'},
          {title:'MrBeast', desc:'Over-the-top challenges and philanthropy.'},
          {title:'Ryan Higa', desc:'Classic sketches and creative shorts.'},
          {title:'Syntac', desc:'Chill survival/building gameplay and guides.'},
          {title:'The King of Random', desc:'DIY science and curiosity projects.'},
        ]
      },
      music: {
        items: [
          {title:'Drake', desc:'Rap/R&B crossover hits and melodies.'},
          {title:'21 Savage', desc:'Gritty storytelling and icy delivery.'},
          {title:'Ye', desc:'Boundary-pushing production and vision.'},
          {title:'Young Thug', desc:'Elastic flows and avant-rap style.'},
          {title:'Gunna', desc:'Smooth, melodic trap anthems.'},
        ]
      }
    };

    const CHANNELS = [
      {id:'movies',  name:'Movies',   number:1},
      {id:'shows',   name:'TV Shows', number:2},
      {id:'cartoons',name:'Cartoons', number:3},
      {id:'youtube', name:'YouTube',  number:4},
      {id:'music',   name:'Music',    number:5},
    ];

    // Load saved TV screen calibration if present
    const SAVED_BOX = JSON.parse(localStorage.getItem('tvBBox')||'null');
    if (SAVED_BOX) {
      const r = document.documentElement.style;
      r.setProperty('--tv-screen-left', SAVED_BOX.left + '%');
      r.setProperty('--tv-screen-top', SAVED_BOX.top + '%');
      r.setProperty('--tv-screen-width', SAVED_BOX.width + '%');
      r.setProperty('--tv-screen-height', SAVED_BOX.height + '%');
    }

    function openTvModal(){
      const last = JSON.parse(localStorage.getItem('tvState')||'{}');
      let currentChannel = last.channel || 'movies';
      let currentSub = last.sub || (TV_DATA.movies.subTabs?.[0]?.id);
      let currentIndex = 0; // always start at #1

      contentEl.innerHTML = `
        <div class="tv-wrap">
          <div class="tv-shell" id="tv-shell">
            <div class="tv-screen tv-glass" id="tv-screen">
              <div class="static" id="tv-static"></div>
              <div class="wipe" id="tv-wipe"></div>
              <div class="screen-inner" id="screen-inner">
                <div class="screen-head">
                  <h3 class="tv-h1" id="tv-title">Movies</h3>
                  <span class="ch-badge" id="ch-badge">CH 1</span>
                </div>
                <p class="tv-sub" id="tv-sub">Flip channels or pick a sub-channel.</p>
                <div class="screen-body">
                  <div class="remote-row" id="subtabs"></div>

                  <div class="card" id="card">
                    <div class="poster" id="poster"></div>
                    <div>
                      <div class="title" id="item-title">—</div>
                      <div class="desc" id="item-desc">—</div>
                      <div class="actions">
                        <button class="btn" id="btn-prev">◀ Prev</button>
                        <span id="pos" style="align-self:center; opacity:.8"></span>
                        <button class="btn" id="btn-next">Next ▶</button>
                        <button class="btn" id="btn-guide">📋 View All</button>
                        <button class="btn" id="btn-power">⏻ Off</button>
                      </div>
                    </div>
                  </div>

                  <div class="guide" id="guide">
                    <div class="actions" style="position:absolute;left:0;top:0;right:0;display:flex;justify-content:flex-end;gap:8px;padding:6px 0;">
                      <button class="btn" id="btn-guide-back">⬅ Back</button>
                    </div>
                    <div class="grid" id="guide-grid"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Calibration overlay -->
            <div id="calib" style="display:none; position:absolute; left:var(--tv-screen-left); top:var(--tv-screen-top); width:var(--tv-screen-width); height:var(--tv-screen-height); outline:2px dashed #7dd3fc; border-radius:18px; box-shadow:0 0 0 9999px rgba(0,0,0,.0); pointer-events:none;">
              <div id="calib-label" style="position:absolute; right:-8px; top:-26px; background:#0f141e; border:1px solid #243049; color:#dce6ff; padding:4px 8px; border-radius:8px; font-size:12px;">L:— T:— W:— H:— (arrows move, Shift=width, Alt=height, S=save, C=copy, Esc=exit)</div>
            </div>
          </div>

          <aside class="controls" id="knobs" aria-label="Remote control">
            <div class="remote-top">
              <button class="btn-round" id="power-remote" title="Power">⏻</button>
              <button class="btn-round" id="prev-item" title="Prev item">◀</button>
              <button class="btn-round" id="next-item" title="Next item">▶</button>
            </div>
            <div class="remote-section">
              ${CHANNELS.map(c=>`<button class="knob" data-ch="${c.id}">CH ${c.number} — ${c.name}</button>`).join('')}
            </div>
            <div class="remote-section">
              <div class="remote-nav">
                <button class="remote-key" data-num="1">1</button>
                <button class="remote-key" data-num="2">2</button>
                <button class="remote-key" data-num="3">3</button>
                <button class="remote-key" data-num="4">4</button>
                <button class="remote-key" data-num="5">5</button>
                <button class="remote-key" data-num="0">RND</button>
              </div>
            </div>
          </aside>
        </div>
      `;

      // Hide the X while TV is open (Power closes the modal)
      closeBtn.style.display = 'none';
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');

      const screen = document.getElementById('tv-screen');
      const chBadge = document.getElementById('ch-badge');
      const titleEl = document.getElementById('tv-title');
      const subEl = document.getElementById('tv-sub');
      const subtabsEl = document.getElementById('subtabs');
      const poster = document.getElementById('poster');
      const itemTitle = document.getElementById('item-title');
      const itemDesc = document.getElementById('item-desc');
      const pos = document.getElementById('pos');
      const guide = document.getElementById('guide');
      const guideGrid = document.getElementById('guide-grid');
      const card = document.getElementById('card');
      const knobs = document.getElementById('knobs');

      function saveState(){ localStorage.setItem('tvState', JSON.stringify({channel: currentChannel, sub: currentSub})); }
      function huePoster(){ poster.style.filter = `hue-rotate(${Math.floor(Math.random()*360)}deg)`; }
      function setActiveKnob(){ [...knobs.querySelectorAll('.knob')].forEach(k => k.classList.toggle('active', k.dataset.ch === currentChannel)); }

      function renderSubtabs(){
        subtabsEl.innerHTML = '';
        if(currentChannel !== 'movies') return;
        TV_DATA.movies.subTabs.forEach(st=>{
          const b = document.createElement('button');
          b.className = 'pill' + (st.id===currentSub ? ' active':'');
          b.textContent = st.name;
          b.dataset.sub = st.id;
          b.onclick = ()=>{ currentSub = st.id; currentIndex = 0; flip(()=>renderContent()); saveState(); };
          subtabsEl.appendChild(b);
        });
      }

      function listForCurrent(){
        if(currentChannel === 'movies'){
          const found = TV_DATA.movies.subTabs.find(s => s.id===currentSub) || TV_DATA.movies.subTabs[0];
          return found.items;
        }
        return TV_DATA[currentChannel].items;
      }

      function setLabels(){
        const chInfo = CHANNELS.find(c=>c.id===currentChannel);
        chBadge.textContent = `CH ${chInfo.number}`;
        titleEl.textContent = chInfo.name;
        if(currentChannel === 'movies'){
          const st = TV_DATA.movies.subTabs.find(s => s.id===currentSub);
          subEl.textContent = st ? st.name : '';
        } else { subEl.textContent = ''; }
      }

      function drawItem(){
        const list = listForCurrent();
        if(list.length===0){ itemTitle.textContent = '—'; itemDesc.textContent=''; pos.textContent=''; return; }
        if(currentIndex<0) currentIndex = list.length-1;
        if(currentIndex>=list.length) currentIndex=0;
        const pick = list[currentIndex];
        itemTitle.textContent = pick.title;
        itemDesc.textContent = pick.desc;
        pos.textContent = `${currentIndex+1} / ${list.length}`;
        huePoster();
      }

      function flip(cb){
        screen.classList.remove('flip'); void screen.offsetWidth; screen.classList.add('flip');
        setTimeout(()=>{ cb && cb(); }, 260);
      }
      function renderContent(){
        setActiveKnob(); renderSubtabs(); setLabels(); drawItem();
        guide.classList.remove('show'); card.style.display = '';
      }

      // Initial render
      renderContent();

      // Top arrow buttons cycle items
      document.getElementById('prev-item').onclick = ()=>{ currentIndex--; flip(drawItem); };
      document.getElementById('next-item').onclick = ()=>{ currentIndex++; flip(drawItem); };

      // CH buttons change channel; reset to #1 each time
      knobs.querySelectorAll('.knob').forEach(k=>{
        k.onclick = ()=>{
          const next = k.dataset.ch;
          if(next === currentChannel) return;
          currentChannel = next;
          currentIndex = 0;
          if(currentChannel === 'movies' && !currentSub){
            currentSub = TV_DATA.movies.subTabs[0].id;
          }
          flip(()=>{ renderContent(); saveState(); });
        };
      });

      // Numeric quick-select 1–5  + 0 = random media across all channels
      knobs.querySelectorAll('.remote-key').forEach(k=>{
        k.onclick = ()=>{
          const n = k.dataset.num;

          if (n === '0') {
            // Random channel
            const ids = CHANNELS.map(c=>c.id);
            currentChannel = ids[Math.floor(Math.random()*ids.length)];
            // Random sub if Movies
            if (currentChannel === 'movies') {
              const subs = TV_DATA.movies.subTabs;
              currentSub = subs[Math.floor(Math.random()*subs.length)].id;
            } else {
              currentSub = null;
            }
            // Random item in that list
            const list = (currentChannel === 'movies'
              ? TV_DATA.movies.subTabs.find(s=>s.id===currentSub).items
              : TV_DATA[currentChannel].items);
            currentIndex = Math.floor(Math.random()*list.length);
            flip(()=>{ renderContent(); saveState(); });
            return;
          }

          if (n>0 && n<=5){
            const id = CHANNELS[n-1].id;
            knobs.querySelector(`.knob[data-ch="${id}"]`).click();
          }
        };
      });

      // On-screen buttons
      document.getElementById('btn-prev').onclick = ()=>{ currentIndex--; flip(drawItem); };
      document.getElementById('btn-next').onclick = ()=>{ currentIndex++; flip(drawItem); };
      document.getElementById('btn-guide').onclick = ()=>{
        guide.classList.add('show'); card.style.display='none';
        const list = listForCurrent();
        guideGrid.innerHTML = list.map((x,i)=>`
          <div class="item">
            <div class="num">#${i+1}</div>
            <div class="title">${x.title}</div>
            <div class="desc">${x.desc}</div>
          </div>
        `).join('');
      };
      document.getElementById('btn-guide-back').onclick = ()=>{
        guide.classList.remove('show'); card.style.display='';
      };
      document.getElementById('btn-power').onclick = hideModal;
      document.getElementById('power-remote').onclick = hideModal;

      // Keyboard: Left/Right items, digits for channels
      function onKey(e){
        if(modal.style.display !== 'flex') return;
        if(e.key === 'ArrowLeft'){ document.getElementById('prev-item').click(); }
        else if(e.key === 'ArrowRight'){ document.getElementById('next-item').click(); }
        else if(e.key >= '1' && e.key <= '5'){
          const id = CHANNELS[Number(e.key)-1].id;
          knobs.querySelector(`.knob[data-ch="${id}"]`).click();
        } else if (e.key === '0') {
          knobs.querySelector('.remote-key[data-num="0"]').click();
        }
      }
      document.addEventListener('keydown', onKey);

      /* Calibration: Alt/Option-click CH badge; arrows move, Shift width, Alt height, S save, C copy CSS */
      const calib = document.getElementById('calib');
      const label = document.getElementById('calib-label');
      let calibOn = false;
      function readVars(){ const cs = getComputedStyle(document.documentElement); return { left: parseFloat(cs.getPropertyValue('--tv-screen-left')), top: parseFloat(cs.getPropertyValue('--tv-screen-top')), width: parseFloat(cs.getPropertyValue('--tv-screen-width')), height: parseFloat(cs.getPropertyValue('--tv-screen-height')) }; }
      function writeVars(v){ const r = document.documentElement.style; r.setProperty('--tv-screen-left', v.left + '%'); r.setProperty('--tv-screen-top', v.top + '%'); r.setProperty('--tv-screen-width', v.width + '%'); r.setProperty('--tv-screen-height', v.height + '%'); updateLabel(v); }
      function updateLabel(v){ label.textContent = `L:${v.left.toFixed(1)} T:${v.top.toFixed(1)} W:${v.width.toFixed(1)} H:${v.height.toFixed(1)} (arrows move, Shift=width, Alt=height, S=save, C=copy, Esc=exit)`; }
      function toggleCalib(){ calibOn = !calibOn; calib.style.display = calibOn ? 'block' : 'none'; if(calibOn){ const v = readVars(); updateLabel(v);} }
      chBadge.addEventListener('click', (e)=>{ if(e.altKey) toggleCalib(); });
      document.addEventListener('keydown', (e)=>{
        if(!calibOn) return;
        const step = (e.metaKey||e.ctrlKey) ? 0.1 : (e.shiftKey||e.altKey ? 0.2 : 0.5);
        const v = readVars();
        if(!e.shiftKey && !e.altKey){ if(e.key==='ArrowLeft') v.left-=step; if(e.key==='ArrowRight') v.left+=step; if(e.key==='ArrowUp') v.top-=step; if(e.key==='ArrowDown') v.top+=step; }
        if(e.shiftKey){ if(e.key==='ArrowLeft') v.width-=step; if(e.key==='ArrowRight') v.width+=step; }
        if(e.altKey && !e.shiftKey){ if(e.key==='ArrowUp') v.height-=step; if(e.key==='ArrowDown') v.height+=step; }
        if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)){ e.preventDefault(); writeVars(v); }
        if(e.key.toLowerCase()==='s'){ localStorage.setItem('tvBBox', JSON.stringify(v)); updateLabel(v); }
        if(e.key.toLowerCase()==='c'){
          const css = `--tv-screen-left: ${v.left}%;\n--tv-screen-top: ${v.top}%;\n--tv-screen-width: ${v.width}%;\n--tv-screen-height: ${v.height}%;`;
          navigator.clipboard?.writeText(css); updateLabel(v);
        }
        if(e.key==='Escape'){ calibOn = false; calib.style.display = 'none'; }
      });

      // Clean up listeners & restore X on close
      const origHide = hideModal;
      hideModal = function(){
        document.removeEventListener('keydown', onKey);
        closeBtn.style.display = ''; // restore X for other modals
        origHide();
      };
    }
  </script>
</body>
</html>
