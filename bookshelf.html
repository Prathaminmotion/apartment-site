<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deluxe Bookshelf</title>
  <style>
    :root{
      --bg:#0c0f14;
      --panel:#12161d;
      --text:#eef2f7;
      --muted:#9aa4b2;
      --accent:#7dd3fc; /* tweak to match site */
      --wood1:#2b1d12; --wood2:#3b2719; --wood3:#5a3b25; --woodHL:#a06b3f;
      --radius:16px; --blur:14px;
      --shadow:0 10px 30px rgba(0,0,0,.42);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;}

    /* Top controls */
    .toolbar{
      position:sticky;top:0;z-index:50;display:flex;gap:.6rem;align-items:center;justify-content:center;
      padding:.6rem; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0));
      backdrop-filter:saturate(130%) blur(8px);
    }
    .chip{display:flex;align-items:center;gap:.45rem;border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:.4rem .7rem;background:#0e1218;box-shadow:var(--shadow)}
    .chip input[type="text"]{background:transparent;border:0;outline:0;color:var(--text);width:210px}
    .chip button,.btn{border:1px solid rgba(255,255,255,.1);background:#0d1117;color:var(--text);border-radius:12px;padding:.44rem .7rem;cursor:pointer}
    .btn.primary{border-color:transparent;background:linear-gradient(135deg,var(--accent),#4aa6d7);color:#001319}
    .btn.ghost{background:transparent}
    select{background:#0d1117;color:var(--text);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:.45rem .6rem}

    /* Bookshelf stage */
    .stage{max-width:1100px;margin:0 auto;padding:12px 12px 80px; perspective:1200px}
    .shelf{
      position:relative; height:140px; margin:18px 0; border-radius:12px; overflow:hidden;
      background:
        linear-gradient(180deg, rgba(0,0,0,.25), transparent 35%),
        repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0 1px, transparent 1px 6px),
        linear-gradient(90deg, var(--wood2), var(--wood3));
      box-shadow: inset 0 -3px 0 rgba(0,0,0,.45), 0 18px 40px rgba(0,0,0,.45);
      transform: rotateX(6deg);
    }
    .shelf:before{content:"";position:absolute;inset:0;background:radial-gradient(1200px 60px at 50% 10%, rgba(255,255,255,.12), transparent 60%)}

    .spines{position:absolute; inset:10px 10px 10px 10px; display:flex; gap:8px; align-items:flex-end}

    .spine{ --w:46px; width:var(--w); height:100%; border-radius:6px; 
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.15)), var(--bgGrad);
      border:1px solid rgba(255,255,255,.12); box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 10px 18px rgba(0,0,0,.35);
      position:relative; cursor:pointer; transform: translateZ(0); transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .spine:hover{ transform: translateY(-4px) scale(1.02); box-shadow: 0 16px 30px rgba(0,0,0,.45); filter:saturate(110%)}
    .spine .title{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) rotate(-90deg);
      transform-origin:center; width:120px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; color:#fff; font-weight:700; letter-spacing:.5px; font-size:.9rem; text-shadow:0 2px 8px rgba(0,0,0,.5)}
    .spine .band{position:absolute; left:0; right:0; height:4px; background:rgba(255,255,255,.2)}
    .spine .band.top{top:12px} .spine .band.bot{bottom:12px}

    /* Spotlight lanes */
    .shelf:hover .lane{opacity:.35}
    .lane{position:absolute; top:0; bottom:0; width:7px; background:linear-gradient(180deg, rgba(255,255,255,.7), transparent); opacity:0; transition:opacity .2s}

    /* Detail modal (book opens) */
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; place-items:center; z-index:120}
    .overlay.show{display:grid}
    .book-modal{ width:min(900px,94vw); background:transparent; position:relative; perspective:1400px }

    .book{
      position:relative; height:520px; display:grid; grid-template-columns: 1fr 1fr; gap:0; transform-style:preserve-3d;
    }
    .page{ background: var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow: var(--shadow);
      padding:16px 16px 18px; overflow:auto; backdrop-filter: blur(var(--blur));
    }
    .cover{ background: var(--coverGrad); color:#001319; display:flex; align-items:flex-end; justify-content:flex-start; padding:18px; border-radius:var(--radius); border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow);}
    .cover h2{margin:0; font-size:1.4rem}

    .book.flip .cover{ transform: rotateY(-160deg); transform-origin: left; transition: transform .6s cubic-bezier(.22,1,.36,1)}
    .book.flip .right{ transform: rotateY(0)}
    .right{ transform: rotateY(5deg); transform-origin:right; transition: transform .6s cubic-bezier(.22,1,.36,1)}

    .meta{display:grid; grid-template-columns:1fr 1fr; gap:.6rem; margin:.4rem 0 1rem}
    .muted{color:var(--muted)}

    .note{ width:100%; min-height:120px; background:#0d1117; color:var(--text); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:.6rem; resize:vertical }

    .tags{display:flex; gap:.4rem; flex-wrap:wrap; margin-top:.5rem}
    .tag{background:#0f141b;border:1px solid rgba(255,255,255,.1); color:var(--muted); padding:.2rem .5rem; border-radius:999px; cursor:default}

    .modal-actions{display:flex; justify-content:space-between; align-items:center; gap:.6rem; margin-top:10px}

    /* Right sheet: grid list */
    .sheet{position:fixed; inset:0; display:flex; justify-content:flex-end; background:rgba(0,0,0,.35); z-index:100; opacity:0; pointer-events:none; transition:opacity .25s}
    .sheet.show{opacity:1; pointer-events:auto}
    .panel{ width:min(640px,94vw); height:100%; background:var(--panel); border-left:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow);
      transform:translateX(100%); transition: transform .4s cubic-bezier(.22,1,.36,1); display:flex; flex-direction:column }
    .sheet.show .panel{ transform:translateX(0) }

    .panel header{display:flex; align-items:center; gap:.6rem; padding:.8rem; position:sticky; top:0; background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,0)); backdrop-filter: blur(10px)}
    .panel header input{flex:1; padding:.55rem .7rem; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#0f141b; color:var(--text)}

    .grid{ padding:1rem; display:grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:.9rem; overflow:auto }
    .card{ background:#0f141b; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:.7rem; cursor:pointer; transition: transform .16s, border-color .16s }
    .card:hover{ transform: translateY(-2px); border-color: rgba(125,211,252,.5) }
    .cover-sm{ height:120px; border-radius:10px; margin-bottom:.55rem; display:flex; align-items:center; justify-content:center; font-weight:800; letter-spacing:.5px; text-transform:uppercase }
    .title{ font-size:.98rem; margin:0 0 .25rem }
    .author{ color:var(--muted); margin:0; font-size:.86rem }

    /* Floating actions */
    .fab{ position:fixed; right:18px; bottom:18px; width:46px; height:46px; border-radius:50%; border:1px solid rgba(255,255,255,.12); background:linear-gradient(135deg,var(--accent),#4aa6d7); color:#001319; font-weight:800; display:grid; place-items:center; cursor:pointer; box-shadow: var(--shadow); z-index:60 }

    /* Mobile tweaks */
    @media (max-width: 720px){
      .spine{ --w:34px }
      .book{ height:78vh; grid-template-columns:1fr }
      .cover{ min-height:220px }
      .right{ transform:none }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .spine, .book, .panel{ transition:none }
    }
  </style>
</head>
<body>
  <div class="toolbar" role="region" aria-label="Bookshelf controls">
    <div class="chip" title="Search (press /)"><span>ðŸ”Ž</span><input id="q" type="text" placeholder="Search booksâ€¦ ( / )" /></div>
    <select id="sort">
      <option value="title">Sort: Title</option>
      <option value="author">Sort: Author</option>
      <option value="recent">Sort: Recently Opened</option>
    </select>
    <button id="openSheet" class="btn ghost" title="Open list">All Books</button>
    <button id="randomBtn" class="btn" title="Random pick">Shuffle</button>
  </div>

  <main class="stage" id="stage" aria-live="polite"></main>

  <!-- Detail modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="book-modal" role="dialog" aria-modal="true" aria-label="Book details">
      <div class="book" id="bookEl">
        <section class="page cover" id="coverPage"><h2 id="coverTitle">Title</h2></section>
        <section class="page right">
          <h2 id="titleOut">Title</h2>
          <p class="muted" id="authorOut">by Author</p>
          <div class="meta">
            <div><span class="muted">Added:</span> <span id="addedOut"></span></div>
            <div><span class="muted">Opened:</span> <span id="openedOut"></span></div>
          </div>
          <p id="synOut"></p>
          <div class="tags" id="tags"></div>
          <label class="muted" for="note">Your notes</label>
          <textarea id="note" class="note" placeholder="Write thoughts, quotes, or toâ€‘dos about this bookâ€¦"></textarea>
          <div class="modal-actions">
            <div style="display:flex;gap:.5rem">
              <button id="saveNote" class="btn primary">Save note</button>
              <button id="deleteBook" class="btn" title="Delete this book">Delete</button>
            </div>
            <button id="closeModal" class="btn">Close (Esc)</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Right sheet (grid list) -->
  <div class="sheet" id="sheet" aria-hidden="true">
    <aside class="panel">
      <header>
        <input id="filter" type="text" placeholder="Filter by title or author" />
        <button id="addBook" class="btn">Add book</button>
        <button id="closeSheet" class="btn">Close</button>
      </header>
      <div class="grid" id="grid"></div>
    </aside>
  </div>

  <button class="fab" id="fab" title="Add book">ï¼‹</button>

  <template id="cardTpl">
    <div class="card">
      <div class="cover-sm"></div>
      <p class="title"></p>
      <p class="author"></p>
    </div>
  </template>

  <script>
    // --- Data & helpers ---
    const DEFAULT_BOOKS = [
      { title: "The Lightning Thief", author: "Rick Riordan", synopsis: "Percy discovers he's a demigod and must retrieve Zeus's lightning bolt.", tags:["YA","Fantasy"] },
      { title: "Harry Potter and the Sorcerer's Stone", author: "J.K. Rowling", synopsis: "A young wizard discovers the magical world and a dark foe.", tags:["Fantasy"] },
      { title: "Wings of Fire: The Dragonet Prophecy", author: "Tui T. Sutherland", synopsis: "Dragonets raised to end a war must choose their destiny.", tags:["Dragons","Series"] },
      { title: "Diary of a Wimpy Kid", author: "Jeff Kinney", synopsis: "Greg Heffley's hilarious middle-school misadventures.", tags:["Humor","Middle Grade"] },
    ];

    const store = {
      key: 'deluxe_books_v1',
      notesKey: 'deluxe_notes_v1',
      load(){
        const raw = localStorage.getItem(this.key);
        const books = raw ? JSON.parse(raw) : DEFAULT_BOOKS.map(b=>({...b, id:crypto.randomUUID(), added:Date.now(), opened:0}));
        const notes = JSON.parse(localStorage.getItem(this.notesKey) || '{}');
        return {books, notes};
      },
      saveBooks(books){ localStorage.setItem(this.key, JSON.stringify(books)); },
      saveNotes(notes){ localStorage.setItem(this.notesKey, JSON.stringify(notes)); }
    };

    const state = {
      ...store.load(),
      q:'', sort:'title',
      get filtered(){
        const q = this.q.toLowerCase();
        let arr = this.books.filter(b=>
          !q || b.title.toLowerCase().includes(q) || b.author.toLowerCase().includes(q)
        );
        if(this.sort==='title') arr.sort((a,b)=>a.title.localeCompare(b.title));
        if(this.sort==='author') arr.sort((a,b)=>a.author.localeCompare(b.author));
        if(this.sort==='recent') arr.sort((a,b)=>(b.opened||0)-(a.opened||0));
        return arr;
      }
    };

    // Gradient generator for covers/spines
    function gradientFor(seed){
      let h=0; for(let i=0;i<seed.length;i++) h=(h*31+seed.charCodeAt(i))>>>0;
      const a=h%360, b=(h*3)%360; return `linear-gradient(135deg, hsl(${a} 75% 48%), hsl(${b} 70% 36%))`;
    }

    // --- Render shelves ---
    const stage = document.getElementById('stage');

    function buildShelves(){
      stage.innerHTML='';
      const perRow = Math.max(8, Math.floor(stage.clientWidth/70));
      const rows = Math.ceil(state.filtered.length / perRow) || 1;
      let idx=0;
      for(let r=0;r<rows;r++){
        const shelf = document.createElement('section'); shelf.className='shelf';
        const spines = document.createElement('div'); spines.className='spines'; shelf.appendChild(spines);

        // spotlight lanes
        for(let i=0;i<12;i++){ const lane=document.createElement('i'); lane.className='lane'; lane.style.left=(i*8)+'%'; shelf.appendChild(lane); }

        for(let c=0;c<perRow;c++){
          const b = state.filtered[idx++]; if(!b) break;
          const spine = document.createElement('div'); spine.className='spine';
          spine.style.setProperty('--w', (40 + (b.title.length%18))+'px');
          spine.style.setProperty('--bgGrad', gradientFor(b.title));
          spine.dataset.id = b.id;
          spine.innerHTML = `<span class="band top"></span><span class="band bot"></span><span class="title">${b.title}</span>`;
          spine.addEventListener('click', ()=> openBook(b.id));
          spines.appendChild(spine);
        }
        stage.appendChild(shelf);
      }
    }

    // --- Detail modal ---
    const overlay = document.getElementById('overlay');
    const bookEl = document.getElementById('bookEl');
    const coverPage = document.getElementById('coverPage');
    const titleOut = document.getElementById('titleOut');
    const authorOut = document.getElementById('authorOut');
    const synOut = document.getElementById('synOut');
    const addedOut = document.getElementById('addedOut');
    const openedOut = document.getElementById('openedOut');
    const noteEl = document.getElementById('note');
    const tagWrap = document.getElementById('tags');
    const saveNoteBtn = document.getElementById('saveNote');
    const deleteBtn = document.getElementById('deleteBook');

    let currentId = null;

    function openBook(id){
      const b = state.books.find(x=>x.id===id); if(!b) return;
      currentId=id; b.opened = Date.now(); store.saveBooks(state.books);
      document.getElementById('coverTitle').textContent = b.title;
      coverPage.style.setProperty('--coverGrad', gradientFor(b.title));
      titleOut.textContent = b.title;
      authorOut.textContent = 'by ' + b.author;
      synOut.textContent = b.synopsis || '';
      addedOut.textContent = new Date(b.added||Date.now()).toLocaleDateString();
      openedOut.textContent = b.opened ? new Date(b.opened).toLocaleDateString() : 'â€”';
      tagWrap.innerHTML = (b.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      noteEl.value = state.notes[id] || '';

      overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
      // flip animation
      bookEl.classList.remove('flip'); void bookEl.offsetWidth; bookEl.classList.add('flip');
    }

    function closeBook(){ overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); }

    document.getElementById('closeModal').addEventListener('click', closeBook);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeBook(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { if(overlay.classList.contains('show')) closeBook(); if(sheet.classList.contains('show')) closeSheet(); } if(e.key==='/'){ e.preventDefault(); qEl.focus(); } });

    saveNoteBtn.addEventListener('click', ()=>{
      if(!currentId) return; state.notes[currentId] = noteEl.value; store.saveNotes(state.notes);
      saveNoteBtn.textContent='Saved âœ”'; setTimeout(()=> saveNoteBtn.textContent='Save note', 900);
    });

    deleteBtn.addEventListener('click', ()=>{
      if(!currentId) return; if(!confirm('Remove this book from your shelf?')) return;
      state.books = state.books.filter(b=>b.id!==currentId); store.saveBooks(state.books);
      delete state.notes[currentId]; store.saveNotes(state.notes);
      closeBook(); refresh();
    });

    // --- Grid sheet ---
    const sheet = document.getElementById('sheet');
    const grid = document.getElementById('grid');
    const closeSheetBtn = document.getElementById('closeSheet');
    function openSheet(){ sheet.classList.add('show'); sheet.setAttribute('aria-hidden','false'); renderGrid(state.filtered); }
    function closeSheet(){ sheet.classList.remove('show'); sheet.setAttribute('aria-hidden','true'); }
    closeSheetBtn.addEventListener('click', closeSheet);
    sheet.addEventListener('click', (e)=>{ if(e.target===sheet) closeSheet(); });

    function renderGrid(items){
      grid.innerHTML='';
      for(const b of items){
        const card = document.getElementById('cardTpl').content.firstElementChild.cloneNode(true);
        const cov = card.querySelector('.cover-sm'); cov.style.background = gradientFor(b.title); cov.textContent = b.title.split(' ').slice(0,2).map(w=>w[0]).join('');
        card.querySelector('.title').textContent = b.title;
        card.querySelector('.author').textContent = b.author;
        card.addEventListener('click', ()=>{ closeSheet(); openBook(b.id); });
        grid.appendChild(card);
      }
    }

    // --- Add book flow ---
    function addBookFlow(){
      const title = prompt('Title?'); if(!title) return;
      const author = prompt('Author?') || 'Unknown';
      const synopsis = prompt('Short synopsis (optional)') || '';
      const tags = (prompt('Tags (comma separated, optional)')||'').split(',').map(s=>s.trim()).filter(Boolean);
      const b = { id:crypto.randomUUID(), title, author, synopsis, tags, added:Date.now(), opened:0 };
      state.books.push(b); store.saveBooks(state.books); refresh();
      setTimeout(()=> openBook(b.id), 50);
    }

    // --- Toolbar wiring ---
    const qEl = document.getElementById('q');
    const sortEl = document.getElementById('sort');
    const filterEl = document.getElementById('filter');
    document.getElementById('openSheet').addEventListener('click', openSheet);
    document.getElementById('addBook').addEventListener('click', addBookFlow);
    document.getElementById('fab').addEventListener('click', addBookFlow);

    qEl.addEventListener('input', ()=>{ state.q=qEl.value; refresh(false); });
    filterEl.addEventListener('input', ()=> renderGrid(state.filtered.filter(b=> b.title.toLowerCase().includes(filterEl.value.toLowerCase()) || b.author.toLowerCase().includes(filterEl.value.toLowerCase()))));
    sortEl.addEventListener('change', ()=>{ state.sort=sortEl.value; refresh(false); });

    document.getElementById('randomBtn').addEventListener('click', ()=>{
      const arr = state.filtered; if(!arr.length) return; const pick = arr[Math.floor(Math.random()*arr.length)]; openBook(pick.id);
    });

    // Initial render & refresh
    function refresh(rebuild=true){ if(rebuild) buildShelves(); renderGrid(state.filtered); }
    window.addEventListener('resize', ()=> buildShelves());

    // Load and go
    refresh();
  </script>
</body>
</html>
